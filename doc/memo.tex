\documentclass[xelatex,ja=standard]{bxjsarticle}
\setCJKmainfont[BoldFont=NotoSerifCJKjp-Black]{NotoSerifCJKjp-Light}
\setCJKsansfont[BoldFont=NotoSansCJKjp-Black]{NotoSansCJKjp-Light}
\setCJKmonofont[BoldFont=NotoSansCJKjp-Black]{NotoSansCJKjp-Light}
\usepackage{physics}
\usepackage{bm}
\usepackage[colorlinks=true, linkcolor=black, citecolor=black, urlcolor=blue]{hyperref}
\usepackage{graphicx}



\title{シュレーディンガー方程式を有限要素法で解く}
\author{山本峻介}
\date{\today}

\begin{document}

\maketitle

\section{水素原子}
\subsection{シュレーディンガー方程式}
水素原子のシュレーディンガー方程式は
\begin{align}
    \qty(-\frac{\hbar^2}{2\mu}\nabla^2 -\frac{e^2}{4\pi\epsilon_0 r})\psi = E\psi
\end{align}
である。無次元量$R, E_0$により、
\begin{align}
    r = R\tilde{r},\quad E = E_0\varepsilon
\end{align}
と変換すると、
\begin{align}
    \qty(-\frac{1}{2}\tilde\nabla^2 - \frac{\mu R e^2}{\hbar^2 4\pi\epsilon_0}\frac{1}{\tilde r})\psi = \frac{\mu E_0R^2}{\hbar^2}\varepsilon\psi
\end{align}
となる。ここで、
\begin{align}
    R = \frac{\hbar^2 4\pi\epsilon_0}{\mu e^2}, \quad E_0 = \frac{\hbar^2}{\mu R^2}
\end{align}
とすれば、
\begin{align}
    \qty(-\frac{1}{2}\tilde\nabla^2 - \frac{1}{\tilde r})\psi = \varepsilon\psi\label{eq:dimless}
\end{align}
となる。$R$はボーア半径である。

(\ref{eq:dimless})の動経成分は
\begin{align}
    \qty[-\frac{1}{2}\qty(\frac{1}{r^2}\dv{r}r^2\dv{r} - \frac{l(l+1)}{r^2})
     - \frac{1}{r}]\psi = \varepsilon\psi
\end{align}
となる。$\chi = rR$を導入すると、
\begin{align}
    -\frac{1}{2}\qty(\dv[2]{r} - \frac{l(l+1)}{r^2})\chi - \frac{1}{r}\chi = \varepsilon\chi
\end{align}
となる。 

\subsection{弱形式}
次の固有方程式
\begin{align}
    \qty(\dv[2]{x} + v(x))f = \lambda f\label{eq:eigen}
\end{align}
の弱解を求める。$f$に対してテスト関数$g$を掛けて積分すると、
\begin{align}
    \int_0^Lg\qty(\dv[2]{x} + v)f\dd{x} &= \lambda\int_0^Lgf\dd{x}\notag\\
    \qty[g\dv{f}{x}]_0^L+\int_0^L\qty(-\dv{g}{x}\dv{f}{x} + gvf)\dd{x}
     &= \lambda\int_0^Lgf\dd{x}
\end{align}
境界条件$f(0) = f(L) = 0$のとき、$g(0) = g(L) = 0$としてよく、
\begin{align}
    \int_0^L\qty(-\dv{g}{x}\dv{f}{x} + gvf)\dd{x}
     &= \lambda\int_0^Lgf\dd{x}\label{eq:weak}
\end{align}
となる。  任意の$g$に対して(\ref{eq:weak})が成り立つとき、$f$は(\ref{eq:eigen})の弱解である。
\subsection{有限要素法}
%(\ref{eq:weak})の被積分関数は、$\dv{g}{x}\dv{f}{x}$と$h(x)g(x)f(x)$からなる。
区間$\qty[0,L]$を$N$等分する。$l$番目の区間を$[x^l_0,x^l_1]$とし、$g_{0(1)} = g(x=x^l_{0(1)})$, $f_{0(1)} = f(x=x^l_{0(1)})$, $h^l = x^l_1 - x^l_0$とすると、
\begin{align}
    g(x) &= \frac{x^l_1 - x}{h^l}g_0 + \frac{x-x^l_0}{h^l}g_1,\\
    f(x) &= \frac{x^l_1 - x}{h^l}f_0 + \frac{x-x^l_0}{h^l}f_1,\\
    v(x) &= \frac{x^l_1 - x}{h^l}v_0 + \frac{x-x^l_0}{h^l}v_1
\end{align}
となる。これらにより、
\begin{align}
    \int_0^L \dv{g}{x}\dv{f}{x}\dd{x} 
    &= \sum_{l=1}^N \frac{1}{{h^l}^2}\int_{x_l^e}^{x^l_1}\qty(-g^l_0 + g^l_1)\qty(-f^l_0 + f^l_1)\dd{x}\notag\\
    &= \sum_{l=1}^N \frac{1}{{h^l}^2}\int_{x^l_0}^{x^l_1}\mqty(g^l_0 & g^l_1)\mqty(-1\\1)\mqty(-1 & 1)\mqty(f^l_0 \\ f^l_1)\dd{x}\notag\\
    &= \sum_{l=1}^N \frac{1}{{h^l}^2}\int_{x^l_0}^{x^l_1}\mqty(g^l_0 & g^l_1)\mqty(1 & -1 \\ -1 & 1)\mqty(f^l_0 \\ f^l_1)\dd{x}\notag\\
    &= \sum_{l=1}^N \frac{1}{h^l}\mqty(g^l_0 & g^l_1)\mqty(1 & -1 \\ -1 & 1)\mqty(f^l_0 \\ f^l_1),
\end{align}
\begin{align}
    \int_0^L vgf\dd{x}
    =& \sum_{l=1}^N \frac{1}{{h^l}^3}\int_{x^l_0}^{x^l_1}
    \qty(\qty(x^l_1 - x)v^l_0 + \qty(x-x^l_0)v^l_1)
    \qty(\qty(x^l_1 - x)g^l_0 + \qty(x-x^l_0)g^l_1)\notag\\
    &\times\qty(\qty(x^l_1 - x)f^l_0 + \qty(x-x^l_0)f^l_1)
    \dd{x}\notag\\
    =& \sum_{l=1}^N \frac{1}{{h^l}^3}\int_{x^l_0}^{x^l_1}
    \mqty(g^l_0 & g^l_1) \mqty(x^l_1 - x \\ x-x^l_0)
    \qty(\qty(x^l_1 - x)v^l_0 + \qty(x-x^l_0)v^l_1)\notag\\
    &\times\mqty(x^l_1 - x & x-x^l_0)\mqty(f^l_0 \\ f^l_1)
    \dd{x}\notag\\
    =& \frac{1}{12}\sum_{l=1}^N h^l
    \mqty(g^l_0 & g^l_1) \mqty(3v_0^l +v_1^l & v_0^l +v_1^l\\ v_0^l +v_1^l&v_0^l +3v_1^l)\mqty(f^l_0 \\ f^l_1),
\end{align}
\begin{align}
    \int_0^L gf\dd{x}
    =& \sum_{l=1}^N \frac{1}{{h^l}^2}\int_{x^l_0}^{x^l_1}
    \qty(\qty(x^l_1 - x)g^l_0 + \qty(x-x^l_0)g^l_1)\qty(\qty(x^l_1 - x)f^l_0 + \qty(x-x^l_0)f^l_1)
    \dd{x}\notag\\
    =& \sum_{l=1}^N \frac{1}{{h^l}^2}\int_{x^l_0}^{x^l_1}
    \mqty(g^l_0 & g^l_1) \mqty(x^l_1 - x \\ x-x^l_0)\mqty(x^l_1 - x & x-x^l_0)\mqty(f^l_0 \\ f^l_1)
    \dd{x}\notag\\
    =& \frac{h^l}{6}\sum_{l=1}^N 
    \mqty(g^l_0 & g^l_1) \mqty(2 & 1\\ 1&2)\mqty(f^l_0 \\ f^l_1),
\end{align}
となる。(\ref{eq:weak})は
\begin{align}
    \sum_{l=1}^N \mqty(g^e_0 & g^e_1)\bigg[\frac{1}{h^l}\mqty(1 & -1 \\ -1 & 1)
     + \frac{h^l}{12}\mqty(3v_{0}^l +v_{1}^l & v_{0}^l +v_{1}^l\\ v_{0}^l +v_{1}^l&v_{0} +3v_{1}^l)\bigg]\mqty(f^l_0 \\ f^l_1)=\lambda\sum_{l=1}^N \frac{h^l}{6} \mqty(g^l_0 & g^l_1)\mqty(2 & 1\\1& 2)\mqty(f^l_0 \\ f^l_1)
\end{align}
となる。 任意の$g$に対して上式が成り立つとき、
\begin{align}
    \sum_{l=1}^N \bigg[\frac{1}{h^l}\mqty(1 & -1 \\ -1 & 1)
     + \frac{h^l}{12}\mqty(3v_{0}^l +v_{1}^l & v_{0}^l +v_{1}^l\\ v_{0}^l +v_{1}^l&v_{0}^l +3v_{1}^l)\bigg]\mqty(f^l_0 \\ f^l_1)&=\lambda\sum_{l=1}^N\frac{h^l}{6} \mqty(2 & 1\\1& 2)\mqty(f^l_0 \\ f^l_1)
\end{align}     
左辺第１項の行列を$K$, 第２項の行列を$V$、右辺の行列を$M$、 固有関数の列を$u$とすると、
\begin{align}
    K&=
     \mqty(
     \frac{1}{h_0} & -\frac{1}{h_0} & 0 & \cdots & 0 & 0 & 0 \\
     -\frac{1}{h_0} & \frac{1}{h_0} + \frac{1}{h_1} & -\frac{1}{h_1} & \cdots & 0 & 0 & 0 \\
     0 & -\frac{1}{h_1} & \frac{1}{h_1} + \frac{1}{h_2} & \cdots & 0 & 0 & 0 \\
     \vdots & \vdots & \vdots & \ddots & \vdots  & \vdots& \vdots\\
     0 & 0 & 0 & \cdots & \frac{1}{h_{N-2}} + \frac{1}{h_{N-1}} & -\frac{1}{h_{N-1}} & 0 \\
     0 & 0 & 0 & \cdots & -\frac{1}{h_{N-1}} &\frac{1}{h_{N-1}} + \frac{1}{h_N} & -\frac{1}{h_N} \\
     0 & 0 & 0 & \cdots & 0 & -\frac{1}{h_N}& \frac{1}{h_N} \\
     ),
\end{align}
\begin{align}
     V&= \frac{1}{12}\left(\mqty{
        \qty(3v_{0} +v_{1})h_0 & \qty(v_{0} +v_{1})h_0 & 0 & \cdots \\
        \qty(v_{0} +v_{1})h_0 & \qty(v_{0} + 3v_{1})h_0 + \qty(3v_{1} +v_{2})h_1 & \qty(v_{1} +v_{2})h_1 & \cdots\\
        0 & \qty(v_{1} +v_{2})h_1 & \qty(v_{1} + 3v_{2})h_1 + \qty(3v_{2} + v_{3})h_2 & \cdots\\
        \vdots & \vdots & \vdots & \ddots\\
        0 & 0 & 0 & \cdots\\
        0 & 0 & 0 & \cdots\\
        }\right.\notag\\
     &  \left.\mqty{
        \cdots  & 0 & 0 & 0 \\
        \cdots & 0 & 0 & 0 \\
        \cdots& 0 & 0 & 0 \\
        \ddots  & \vdots& \vdots& \vdots\\
        \cdots & h_{N-2}\qty(v_{N-2} + 3v_{N-1}) + h_{N-1}\qty(3v_{N-1} + v_{N})& h_{N-1}\qty(v_{N - 1} +v_{N})& 0 \\
        \cdots & h_{N-1}\qty(v_{N - 1} +v_{N})& h_{N-1}\qty(v_{N-1} + 3v_{N}) + h_N\qty(3v_{N} + v_{N +1})& h_N\qty(v_{N} +v_{N+1}) \\
        \cdots &0 & h_N\qty(v_{N-1} +v_{N})& h_N\qty(v_{N} +3v_{N+1}) \\
        }\right),
\end{align}
\begin{align}
    M&=
     \frac{1}{6}\mqty(
     2h_0 & h_0 & 0 & \cdots & 0 & 0 & 0 \\
     h_0 & 2h_0 + 2h_1 & h_1 & \cdots & 0 & 0 & 0 \\
     0 & h_1 & 2h_1 + 2h_2 & \cdots & 0 & 0 & 0 \\
     \vdots & \vdots & \vdots & \ddots & \vdots  & \vdots& \vdots\\
     0 & 0 & 0 & \cdots & 2h_{N - 2} + 2h_{N - 1} & h_{N-1}& 0 \\
     0 & 0 & 0 & \cdots & h_{N-1} & 2h_{N - 1} + 2h_{N}& h_{N} \\
     0 & 0 & 0 & \cdots & 0 & h_{N}& 2h_{N} \\
     ),
\end{align}
\begin{align}
    u&=\mqty(f_0 & f_1 & \cdots & f_N & f_{N+1})^T
\end{align}
となる。ただし、$f_N^0 = f_N,\, f_N^1 = f_{N+1}$（$v$についても同様)である。これらから、
\begin{align}
    \qty(K + V) u = \lambda Mu 
\end{align}
となる。

ディリクレ境界条件$f(0) = f_0 = \alpha$, $f(L) = f_{N+1} = \beta$を課すと
\begin{align}
    K&=
     \mqty(
     \frac{1}{h_0} + \frac{1}{h_1} & -\frac{1}{h_1} & \cdots & 0 & 0\\
     -\frac{1}{h_1} & \frac{1}{h_1} + \frac{1}{h_2} & \cdots & 0 & 0\\
     \vdots & \vdots & \vdots & \ddots & \vdots\\
     0 & 0 & \cdots & \frac{1}{h_{N-2}} + \frac{1}{h_{N-1}} & -\frac{1}{h_{N-1}} \\
     0 & 0 & \cdots & -\frac{1}{h_{N-1}} &\frac{1}{h_{N-1}} + \frac{1}{h_N} \\
     ),
\end{align}
\begin{align}
     V&= \frac{1}{12}\left(\mqty{
        \qty(v_{0} + 3v_{1})h_0 + \qty(3v_{1} +v_{2})h_1 & \qty(v_{1} +v_{2})h_1 & \cdots\\
        \qty(v_{1} +v_{2})h_1 & \qty(v_{1} + 3v_{2})h_1 + \qty(3v_{2} + v_{3})h_2 & \cdots\\
        \vdots & \vdots & \ddots\\
        0 & 0 & \cdots\\
        0 & 0 & \cdots\\
        }\right.\notag\\
     &  \left.\mqty{
        \cdots  & 0 & 0\\
        \cdots & 0 & 0\\
        \cdots& 0 & 0\\
        \ddots  & \vdots& \vdots\\
        \cdots & h_{N-2}\qty(v_{N-2} + 3v_{N-1}) + h_{N-1}\qty(3v_{N-1} + v_{N})& h_{N-1}\qty(v_{N - 1} +v_{N})\\
        \cdots & h_{N-1}\qty(v_{N - 1} +v_{N})& h_{N-1}\qty(v_{N-1} + 3v_{N}) + h_N\qty(3v_{N} + v_{N +1})) \\
        }\right),
\end{align}
\begin{align}
    M&=
     \frac{1}{6}\mqty(
     2h_0 + 2h_1 & h_1 & \cdots & 0 & 0\\
     h_1 & 2h_1 + 2h_2 & \cdots & 0 & 0\\
     \vdots & \vdots & \ddots & \vdots  & \vdots\\
     0 & 0 & \cdots & 2h_{N - 1} + 2h_{N} & h_N\\
     0 & 0 & \cdots & h_N & 2h_{N} + 2h_{N+1} \\
     ),
\end{align}
\begin{align}
    u&=\mqty(f_1 & \cdots & f_N)^T
\end{align}
となる。

井戸型ポテシャルのシュレーディンガー方程式の数値計算の結果を図\ref{fig:eigenfunction}に示す。
エネルギーの収束の様子を図\ref{fig:convergence}に示す。
刻み幅に対して線形であり、収束が遅いことがわかる。

\begin{figure}
    \centering
    \includegraphics[width=0.8\textwidth]{./figs/eigenfunction.pdf}
    \caption{固有関数}
    \label{fig:eigenfunction}
\end{figure}
\begin{figure}
    \centering
    \includegraphics[width=0.8\textwidth]{./figs/convergence.pdf}
    \caption{エネルギー収束の様子。横軸は刻み幅、縦軸はエネルギーの相対誤差。}
    \label{fig:convergence}
\end{figure}
\section{非斉次方程式}
(\ref{eq:weak})から、
\begin{align}
    \int_0^L\qty(\dv{g}{x}\dv{f}{x} + g\lambda(1 - \frac{v}{\lambda})f)\dd{x}
     &= 0 \label{eq:weak2}
\end{align}
となる。
次の補完関数
\begin{align}
    N_p(x) = 
    \begin{cases}
        \frac{x-x_{p-1}}{h}&x_{p-1}<x<x_pの場合\\
        \frac{x_{p+1} - 1}{h}&x_{p}<x<x_{p+1}の場合\\
        0&\text{otherwise}
    \end{cases}
\end{align}
により、
\begin{align}
    f(x) = \sum_{p=1}^N f_pN_p(x),\quad g(x) = \sum_{p=1}^N g_pN_p(x)
\end{align}
とし近似する。(\ref{eq:weak2})に代入すると、
\begin{align}
    \sum_{p=1}^N\sum_{q=1}^N\qty(\int_0^L\qty(\dv{N_p}{x}\dv{N_q}{x} + N_p\lambda(1 - \frac{v}{\lambda})N_q)\dd{x})f_qg_p = 0
\end{align}
となる。左辺第１項は
\begin{align}
    K_{pq} &= \int_0^L\dv{N_p}{x}\dv{N_q}{x}\dd{x}\notag\\
     &= \frac{1}{h}\qty(-\delta_{p,q-1} + 2\delta_{p,q} - \delta_{p,q+1})
\end{align}
$v=0$の時左辺第２項は
\begin{align}
    \int_0^L N_pN_q\dd{x} = \frac{2h}{3}\delta_{p,q} + \frac{h}{6}(\delta_{p,q-1} + \delta_{p,q+1})
\end{align}
\end{document}
